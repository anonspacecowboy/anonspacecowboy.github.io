<html>

<head><title>Leonardo(aracy) ;P</title>
    <style>
        canvas {
            position: absolute;
            left: 50%;
            top: 50%;
            margin-top: -300;
            margin-left: -400;
            background-color: black;
        }
    </style>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
	<div class="game_container" align="center">
		<div id="start_button"> Start
		</div>
		
		<div id="game_layer"></div>
		<canvas height="600" width="800" id="pong_canvas">NÃ£o suportado pelo browser</canvas>
    </div>
    <script>
		var start = false;
		var interval_id;
        var canvas = document.getElementById("pong_canvas");
        var ctx = canvas.getContext("2d");
        var keys = {};
        var ball = {
            width: 16,
            height: 16,
            x: canvas.width/2 - 8,
            y: canvas.height/2 - 8,
            speed: 2,
            dirX: -1,
            dirY: 1,
            speed_rate: 0,
        };

        var bar1 = {
            width: 16,
            height: 100,
            x: 10,
            y: canvas.height/2 - 25,
            score: 0,
            speed: 15,
        };

        var bar2 = {
            width: 16,
            height: 100,
            x: canvas.width - 26,
            y: canvas.height/2 - 25,
            score: 0,
            speed: 15,
        };

        document.addEventListener("keydown", function(e){
            keys[e.keyCode] = true;
        }, false);

        document.addEventListener("keyup", function(e){
            delete keys[e.keyCode];
        }, false);

        function moveBar(){
            if ((87 in keys) && (bar1.y > 0)){
                bar1.y -= bar1.speed;
            }
            if ((83 in keys) && (bar1.y < canvas.height - bar1.height)){
                bar1.y += bar1.speed;
            }

            if ((38 in keys) && (bar2.y > 0)){
                bar2.y -= bar2.speed;
            }
            if ((40 in keys) && (bar2.y < canvas.height - bar2.height)){
                bar2.y += bar2.speed;
            }
        }

        function moveBall(){
            if ((ball.y+ball.height >= bar1.y) && (ball.y <= bar1.y+bar1.height) && (ball.x <= bar1.x + bar1.width)){
                ball.dirX = 1;
                ball.speed_rate += 0.3;
            }
            if ((ball.y+ball.height >= bar2.y) && (ball.y <= bar2.y+bar2.height) && (ball.x + ball.width >= bar2.x)){
                ball.dirX = -1;
                ball.speed_rate += 0.3;
            }
            if(ball.y + ball.height >= canvas.height){
                ball.dirY = -1;
            }
            if(ball.y <= 0){
                ball.dirY = 1;
            }

            ball.x += (ball.speed + ball.speed_rate) * ball.dirX;
            ball.y += (ball.speed + ball.speed_rate) * ball.dirY;

        }

        function score(){
            if(ball.x <= 0) {
                bar2.score+=1;

                ball.x = canvas.width/2 - 8;
                ball.y = canvas.height/2 - 8;
                ball.speed_rate = 0;

                bar1.x = 10;
                bar1.y = canvas.height/2 - 25;
                bar2.x = canvas.width - 26;
                bar2.y = canvas.height/2 - 25;

            }
            if(ball.x+ball.width >= canvas.width) {
                bar1.score+=1;

                ball.x = canvas.width/2 - 8;
                ball.y = canvas.height/2 - 8;
                ball.speed_rate = 0;

                bar1.x = 10;
                bar1.y = canvas.height/2 - 25;
                bar2.x = canvas.width - 26;
                bar2.y = canvas.height/2 - 25;
            }

        }


        function draw(){
            ctx.clearRect(0,0, canvas.width, canvas.height);
            moveBar();
            moveBall();
            score();
            ctx.fillStyle = "white";
            ctx.fillRect(bar1.x, bar1.y, bar1.width, bar1.height);
            ctx.fillRect(bar2.x, bar2.y, bar2.width, bar2.height);
            ctx.fillRect(ball.x, ball.y, ball.width, ball.height);

            ctx.font = "20px Arial";
            ctx.fillText("Player 1: "+ bar1.score, 50 ,20);
            ctx.fillText("Player 2: "+ bar2.score, canvas.width - 150 ,20);
        }

		
		document.getElementById("start_button").addEventListener("click", dummyStartFunction);
		
		//pause code
		document.addEventListener("keydown", function(e){
			if(e.keyCode == 80){
				clearInterval(interval_id);
				start = false;
				document.getElementById("game_layer").style.backgroundColor="rgba(239,239,239,0.8)";
				document.getElementById("start_button").style.display="block";
			}
        }, false);
		
		//start code
		function dummyStartFunction(){
			if(start == false){
				interval_id = setInterval(draw, 10);
				start = true;
				document.getElementById("game_layer").style.backgroundColor="transparent";
				document.getElementById("start_button").style.display="none";
			}
		}

    </script>
</body>

</html>
